sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/model/Filter","sap/ui/core/util/Export","sap/ui/core/util/ExportTypeCSV","sap/m/MessageBox","sap/m/MultiInput","sap/ui/export/Spreadsheet","sap/m/Token","sap/ui/core/library","sap/ui/model/FilterOperator","sap/m/MessageToast"],function(e,t,a,i,l,r,s,o,n,u,d){"use strict";return e.extend("com.bom.sap.com.zbomapp.controller.Worklist",{formatter:a,onInit:function(){var e,a,i=this.byId("table");a=i.getBusyIndicatorDelay();this._aTableSearchState=[];e=new t({worklistTableTitle:this.getResourceBundle().getText("worklistTableTitle"),saveAsTileTitle:this.getResourceBundle().getText("saveAsTileTitle",this.getResourceBundle().getText("worklistViewTitle")),shareOnJamTitle:this.getResourceBundle().getText("worklistTitle"),shareSendEmailSubject:this.getResourceBundle().getText("shareSendEmailWorklistSubject"),shareSendEmailMessage:this.getResourceBundle().getText("shareSendEmailWorklistMessage",[location.href]),tableNoDataText:this.getResourceBundle().getText("tableNoDataText"),tableBusyDelay:0});this.setModel(e,"worklistView");i.attachEventOnce("updateFinished",function(){e.setProperty("/tableBusyDelay",a)});this.addHistoryEntry({title:this.getResourceBundle().getText("worklistViewTitle"),icon:"sap-icon://table-view",intent:"#BillOfMaterialApp-display"},true);this.onComplete=false;this.oBusyDialog=new sap.m.BusyDialog;this.oTableRecCount=0;this.getView().setModel(this.getOwnerComponent().getModel(),"BaseModel");var l="/OPENSAP/sap/opu/odata/sap/API_BILL_OF_MATERIAL_SRV;v=0002";var r=new sap.ui.model.odata.ODataModel(l,true);this.setModel(r,"oRefModel");sap.ui.getCore().setModel(r,"oRefModel");this.oDataInitial={Items:[{columnKey:"BOMCategory",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[1].extensions[1].value},{columnKey:"BOMVariant",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[2].extensions[1].value},{columnKey:"BOMVersion",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[3].extensions[1].value},{columnKey:"BOMItemNoNode",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[4].extensions[1].value},{columnKey:"mat",text:"Father Material"},{columnKey:"plant",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[7].extensions[1].value},{columnKey:"BillOfMaterialItemUUID",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[8].extensions[0].value},{columnKey:"ValidityStartDate",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[10].extensions[1].value},{columnKey:"ValidityEndDate",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[11].extensions[1].value},{columnKey:"EngineeringChangeDocument",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[13].extensions[1].value},{columnKey:"bom",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[20].extensions[1].value},{columnKey:"BillOfMaterialItemCategory",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[21].extensions[1].value},{columnKey:"itm",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[22].extensions[1].value},{columnKey:"BillOfMaterialItemUnit",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[23].extensions[1].value},{columnKey:"qty",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[24].extensions[1].value},{columnKey:"asm",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[25].extensions[1].value},{columnKey:"des",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[41].extensions[0].value},{columnKey:"BOMItemIsSalesRelevant",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[57].extensions[1].value},{columnKey:"IsProductionRelevant",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[58].extensions[1].value},{columnKey:"BOMItemIsCostingRelevant",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[60].extensions[1].value},{columnKey:"IsEngineeringRelevant",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[61].extensions[1].value},{columnKey:"RequiredComponent",text:this.getModel("oRefModel").getServiceMetadata().dataServices.schema[0].entityType[0].property[79].extensions[1].value},{columnKey:"usg",text:"BOM Usage"},{columnKey:"lvl",text:"Level"}],ColumnsItems:[{columnKey:"mat",visible:true,index:0},{columnKey:"BOMCategory",visible:false},{columnKey:"BOMVariant",visible:false},{columnKey:"BOMVersion",visible:false},{columnKey:"BOMItemNoNode",visible:false},{columnKey:"plant",visible:false},{columnKey:"BillOfMaterialItemUUID",visible:false},{columnKey:"ValidityStartDate",visible:false},{columnKey:"ValidityEndDate",visible:false},{columnKey:"EngineeringChangeDocument",visible:false},{columnKey:"bom",visible:false},{columnKey:"BillOfMaterialItemCategory",visible:false},{columnKey:"itm",visible:false},{columnKey:"BillOfMaterialItemUnit",visible:false},{columnKey:"qty",visible:false},{columnKey:"asm",visible:false},{columnKey:"des",visible:false},{columnKey:"BOMItemIsSalesRelevant",visible:false},{columnKey:"IsProductionRelevant",visible:false},{columnKey:"BOMItemIsCostingRelevant",visible:false},{columnKey:"IsEngineeringRelevant",visible:false},{columnKey:"RequiredComponent",visible:false},{columnKey:"usg",visible:false},{columnKey:"lvl",visible:false}],ShowResetEnabled:false};this.oJSONModel=null;this.oDataBeforeOpen={};this.oJSONModel=new t(jQuery.extend(true,{},this.oDataInitial));this.oJSONModel.setDefaultBindingMode(sap.ui.model.BindingMode.TwoWay);var s=this.getView();var n=s.byId("multiInput");var u=function(e){window.setTimeout(function(){e.asyncCallback(new sap.m.Token({text:e.text}))},500);return o.WaitForAsyncValidation};n.addValidator(u)},onUpdateFinished:function(e){var t,a=e.getSource(),i=e.getParameter("total");if(i&&a.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("worklistTableTitleCount",[i])}else{t=this.getResourceBundle().getText("worklistTableTitle")}this.getModel("worklistView").setProperty("/worklistTableTitle",t)},onPress:function(e){this._showObject(e.getSource())},onShareInJamPress:function(){var e=this.getModel("worklistView"),t=sap.ui.getCore().createComponent({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:location.href,share:e.getProperty("/shareOnJamTitle")}}});t.open()},onSearch:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh()}else{var t=[];var a=e.getParameter("query");if(a&&a.length>0){var i=sap.ui.model.FilterOperator.Contains;var l=a.toLowerCase();var r=a.toUpperCase();var s=a[0].toUpperCase()+a.substr(1).toLowerCase();var o=a.replace(/\b\w/g,function(e){return e.toUpperCase()});t=[new sap.ui.model.Filter([new sap.ui.model.Filter("mat",i,a),new sap.ui.model.Filter("mat",i,l),new sap.ui.model.Filter("mat",i,r),new sap.ui.model.Filter("mat",i,s),new sap.ui.model.Filter("mat",i,o)],false)]}this._applySearch(t)}},onRefresh:function(){var e=this.byId("table");e.getBinding("items").refresh()},_showObject:function(e){this.getRouter().navTo("object",{objectId:e.getBindingContext().getProperty("BillOfMaterialHeaderUUID")})},_applySearch:function(e){var t=this.byId("table"),a=this.getModel("worklistView");t.getBinding("items").filter(e,"Application");if(e.length!==0){a.setProperty("/tableNoDataText",this.getResourceBundle().getText("worklistNoDataWithSearchText"))}},onLiveChange:function(e){var t=e.getSource().getValue();this.getView().byId("idPlant").setValue(t.toUpperCase())},onEnterMatNo:function(e){var t=this.getView().byId("multiInput").getValue();var a=t[t.length-1];if(a===","){t=t.substring(0,t.length-1)}var i=new Array;i=t.split(",");for(var l=0;l<i.length;l++){this.getView().byId("multiInput").addToken(new sap.m.Token({text:i[l]}));this.getView().byId("multiInput").setValue("")}},onEnter:function(){this.oBusyDialog.open();var e=this;sap.m.MessageBox.show(" Do you want to proceed?.",{icon:sap.m.MessageBox.Icon.INFORMATION,title:"          Search BOM",actions:["OK","Cancel"],onClose:function(t){if(t==="OK"){e.onBOMSerch()}if(t==="Cancel"){e.oBusyDialog.close()}},initialFocus:"OK"})},onCustomExcel:function(e){var t=sap.ui.xmlfragment("com.bom.sap.com.zbomapp.view.PersonalizationDialog",this);this.oJSONModel.setProperty("/ShowResetEnabled",this._isChangedColumnsItems());t.setModel(this.oJSONModel);this.getView().addDependent(t);this.oDataBeforeOpen=jQuery.extend(true,{},this.oJSONModel.getData());t.open()},onBOMSerch:function(){var e=new Date;var t="datetime '"+e.getUTCFullYear()+"/"+(e.getUTCMonth()+1)+"/"+e.getUTCDate();var a=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var i=new sap.ui.model.json.JSONModel;this.getView().setModel(i,"BRF");var l=0,r=false,s,o=[],n=true,u=0,d=[],m=[],g=[],c=[],f=[],p=0;var v=this.getView().byId("multiInput").getTokens();var h=this.getView().byId("idPlant").getValue().toString();var M=[];for(var y=0;y<v.length;y++){M.push(this.getView().byId("multiInput").getTokens()[y].getProperty("text"))}var O=this.getView().getModel();$.sap.brk=O;var B=this;var I=function(e,v){if(v===null||v===undefined||v.length===0||e===null){B.oBusyDialog.close();i=new sap.ui.model.json.JSONModel;i.setData(o);B.getView().setModel(i,"BRF");return 1}for(var y=0;y<v.length;y++){m.push(new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,v[y]),new sap.ui.model.Filter("Plant",sap.ui.model.FilterOperator.EQ,h)],and:true}));g.push(new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,v[y]),new sap.ui.model.Filter("Plant",sap.ui.model.FilterOperator.EQ,h),new sap.ui.model.Filter("ValidityEndDate",sap.ui.model.FilterOperator.GT,t)],and:true}))}c.push(new sap.ui.model.Filter({filters:m,and:false}));f.push(new sap.ui.model.Filter({filters:g,and:false}));var O=function(t){return new Promise(function(a,i){e.read(t,{filters:c,urlParameters:{$select:"BillOfMaterialCategory,BillOfMaterialVariant,BillOfMaterialVersion,BillOfMaterialItemNodeNumber,Material,Plant,BillOfMaterialItemUUID,ValidityStartDate,ValidityEndDate,EngineeringChangeDocument,BillOfMaterialComponent,BillOfMaterialItemCategory,BillOfMaterialItemNumber,BillOfMaterialItemUnit,BillOfMaterialItemQuantity,IsAssembly,ComponentDescription,BOMItemIsSalesRelevant,IsProductionRelevant,BOMItemIsCostingRelevant,IsEngineeringRelevant,RequiredComponent,IsSubItem,BillOfMaterial,SpecialProcurementType",$orderby:"BillOfMaterialItemNumber"},async:false,success:function(e){a(e)},error:function(e){i(e)}})})};var w=function(t){return new Promise(function(a,i){e.read(t,{filters:c,urlParameters:{$select:"BillOfMaterialVariantUsage,Material"},async:false,success:function(e){a(e)},error:function(e){i(e)}})})};Promise.all([O("/MaterialBOMItem"),w("/MaterialBOM")]).then(function(e){p+=1;for(var t=0;t<e[0].results.length;t++){for(var i=0;i<e[1].results.length;i++){if(e[0].results[t].Material===e[1].results[i].Material){var g=a.format(new Date(e[0].results[t].ValidityStartDate));g=g+"T00:00:00";if(e[0].results[t].ValidityStartDate.length===0){var f="0000-00-00T00:00:00"}else{var f=a.format(new Date(e[0].results[t].ValidityStartDate));f=f+"T00:00:00"}var v=a.format(new Date(e[0].results[t].ValidityEndDate));v=v+"T00:00:00";if(e[0].results[t].ValidityEndDate.length===0){var h="0000-00-00T00:00:00"}else{var h=a.format(new Date(e[0].results[t].ValidityEndDate));h=h+"T00:00:00"}u+=1;d.push({mat:e[0].results[t].Material,itm:e[0].results[t].BillOfMaterialItemNumber,bom:e[0].results[t].BillOfMaterialComponent,asm:e[0].results[t].IsAssembly,des:e[0].results[t].ComponentDescription,qty:e[0].results[t].BillOfMaterialItemQuantity,usg:e[1].results[i].BillOfMaterialVariantUsage,lvl:p,BOMCategory:e[0].results[t].BillOfMaterialCategory,BOMVariant:e[0].results[t].BillOfMaterialVariant,BOMVersion:e[0].results[t].BillOfMaterialVersion,BOMItemNoNode:e[0].results[t].BillOfMaterialItemNodeNumber,plant:e[0].results[t].Plant,BillOfMaterialItemUUID:e[0].results[t].BillOfMaterialItemUUID,ValidityStartDate:f,ValidityEndDate:h,EngineeringChangeDocument:e[0].results[t].EngineeringChangeDocument,BillOfMaterialItemCategory:e[0].results[t].BillOfMaterialItemCategory,BillOfMaterialItemUnit:e[0].results[t].BillOfMaterialItemUnit,BOMItemIsSalesRelevant:e[0].results[t].BOMItemIsSalesRelevant,IsProductionRelevant:e[0].results[t].IsProductionRelevant,BOMItemIsCostingRelevant:e[0].results[t].BOMItemIsCostingRelevant,IsEngineeringRelevant:e[0].results[t].IsEngineeringRelevant,RequiredComponent:e[0].results[t].RequiredComponent,idx:u})}}}if(n){for(var O=0;O<M.length;O++){for(var w=0;w<d.length;w++){if(M[O]===d[w].mat){o.push(d[w])}}}}if(e[0].results===undefined||e[0].results.length===0||e[1].results===undefined||e[1].results.length===0){I(null,null)}if(r){for(var S=0;S<o.length;S++){for(var D=0;D<d.length;D++){if(o[S].bom===d[D].mat){o[S].asm="X";l+=1;o.splice(S+l,0,d[D])}}l=0}}d=[];n=false;r=true;s=[];var T=e[0].results;var b=[],V=[];for(y=0;y<T.length;y++){b.push(new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,T[y].BillOfMaterialComponent),new sap.ui.model.Filter("Plant",sap.ui.model.FilterOperator.EQ,T[y].Plant)],and:true}))}V.push(new sap.ui.model.Filter({filters:b,and:false}));var C=B.getView().getModel();var x=function(e){return new Promise(function(t,a){C.read(e,{filters:V,urlParameters:{$select:"Material"},success:function(e){t(e)},error:function(){}})})};x("/MaterialBOM").then(function(e){for(var t=0;t<e.results.length;t++){s.push(e.results[t].Material)}m=[];c=[];I($.sap.brk,s)})})};I($.sap.brk,M)},onBOMSerch1:function(){var e=new sap.m.BusyDialog;var t="/OPENSAP/sap/opu/odata/sap/API_BILL_OF_MATERIAL_SRV;v=0002";var a=new sap.ui.model.odata.ODataModel(t,true);a.setDefaultBindingMode("TwoWay");a.attachRequestSent(function(){e.open()});var i=new sap.ui.model.json.JSONModel;var l=new sap.ui.model.json.JSONModel;var r=new sap.ui.model.json.JSONModel;r.results=[];var s=[];var o=0;var n="";var u=new Array;var d=[];var m=true;var g=0;var c=[];var f=0;var p=0;var v=false;var h=true;var M=0;var y=false;var O="";var B=this.getView().byId("multiInput").getTokens();var I=this.getView().byId("idPlant").getValue().toString();var w=this.getView().byId("idBOMUsage1").getValue().toString();var S=this.getView().byId("idBOMUsage2").getValue().toString();var D=this.getView().byId("idBOMApp").getValue().toString();if(w.length===0&&S.length===0){w="1";S="5"}var T=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});if(B.length===0||I.length===0){sap.m.MessageBox.warning("Please enter all mandatory fields.");this.oBusyDialog.close()}else{var t="/OPENSAP/sap/opu/odata/sap/API_BILL_OF_MATERIAL_SRV;v=0002";var b=new sap.ui.model.odata.ODataModel(t,true);b.setDefaultBindingMode("TwoWay");var V=3;u[0]=new sap.ui.model.Filter("BillOfMaterialVariant",sap.ui.model.FilterOperator.EQ,D);u[1]=new sap.ui.model.Filter("Plant",sap.ui.model.FilterOperator.EQ,I);u[2]=new sap.ui.model.Filter("BillOfMaterialVariantUsage",sap.ui.model.FilterOperator.EQ,w);u[3]=new sap.ui.model.Filter("BillOfMaterialVariantUsage",sap.ui.model.FilterOperator.EQ,S);for(var C=0;C<B.length;C++){V++;var x=this.getView().byId("multiInput").getTokens()[C].getProperty("text");u[V]=new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,x)}b.read("/MaterialBOM",{filters:u,urlParameters:{$select:"Material"},async:false,success:function(t,a){for(var r=0;r<t.results.length;r++){c[r]=t.results[r].Material}var d="/OPENSAP/sap/opu/odata/sap/API_BILL_OF_MATERIAL_SRV;v=0002";var g=new sap.ui.model.odata.ODataModel(d,true);g.setDefaultBindingMode("TwoWay");f=c.length;do{u=[];var h=1;u[0]=new sap.ui.model.Filter("BillOfMaterialVariant",sap.ui.model.FilterOperator.EQ,D);u[1]=new sap.ui.model.Filter("Plant",sap.ui.model.FilterOperator.EQ,I);h++;u[h]=new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,c[p]);g.read("/MaterialBOMItem",{urlParameters:{$select:"BillOfMaterialCategory,BillOfMaterialVariant,BillOfMaterialVersion,BillOfMaterialItemNodeNumber,Material,Plant,BillOfMaterialItemUUID,ValidityStartDate,ValidityEndDate,EngineeringChangeDocument,BillOfMaterialComponent,BillOfMaterialItemCategory,BillOfMaterialItemNumber,BillOfMaterialItemUnit,BillOfMaterialItemQuantity,IsAssembly,ComponentDescription,BOMItemIsSalesRelevant,IsProductionRelevant,BOMItemIsCostingRelevant,IsEngineeringRelevant,RequiredComponent,IsSubItem,BillOfMaterial,SpecialProcurementType"},filters:u,async:false,success:function(e,t){var a=e.results[0].BillOfMaterial;var r=e.results[0].BillOfMaterialCategory;var d=e.results[0].BillOfMaterialVariant;var f=e.results[0].BillOfMaterialVersion;var v=e.results[0].EngineeringChangeDocument;var h=e.results[0].Material;var B=e.results[0].Plant;var I="/MaterialBOM(BillOfMaterial='"+a+"',BillOfMaterialCategory='"+r+"',BillOfMaterialVariant='"+d+"',BillOfMaterialVersion='"+f+"',EngineeringChangeDocument='"+v+"',Material='"+h+"',Plant='"+B+"')";g.read(I,{urlParameters:{$select:"BillOfMaterialVariantUsage,Material"},filters:u,async:false,success:function(e,t){O=e.BillOfMaterialVariantUsage},error:function(e){}});if(!y){}else{o=o+1;y=false}if(m){for(var w=0;w<e.results.length;w++){e.results[w].IsSubItem=o;e.results[w].SpecialProcurementType=O}for(var S=0;S<e.results.length;S++){e.results[S].BillOfMaterialVersion=c[p];e.results[S].Material=e.results[S].BillOfMaterialComponent}l.setData(e);m=false}else{for(var D=0;D<e.results.length;D++){e.results[D].BillOfMaterialVersion=c[p];e.results[D].Material=e.results[D].BillOfMaterialComponent;e.results[D].IsSubItem=o;e.results[D].SpecialProcurementType=O}i.setData(e);for(var b=0;b<i.getProperty("/results").length;b++){l.getProperty("/results").push(i.getProperty("/results/"+b))}}for(var b=0;b<e.results.length;b++){if(e.results[b].IsAssembly.length>0){n="X";s[M]=e.results[b].BillOfMaterialComponent;M++}var V=T.format(new Date(e.results[b].ValidityStartDate));V=V+"T00:00:00";if(e.results[b].ValidityStartDate.length===0){var C="0000-00-00T00:00:00";e.results[b].ValidityStartDate=C}else{var C=T.format(new Date(e.results[b].ValidityStartDate));C=C+"T00:00:00";e.results[b].ValidityStartDate=C}var V=T.format(new Date(e.results[b].ValidityEndDate));V=V+"T00:00:00";if(e.results[b].ValidityEndDate.length===0){var C="0000-00-00T00:00:00";e.results[b].ValidityEndDate=C}else{var C=T.format(new Date(e.results[b].ValidityEndDate));C=C+"T00:00:00";e.results[b].ValidityEndDate=C}}if(s.length>0){n="X"}else{n=""}},error:function(t){e.close();sap.m.MessageBox.error(t.message)}});p=p+1;if(p<c.length){v=true}else if(n.length>0){c=[];c=s;p=0;y=true;M=0;s=[];v=true}else{v=false}}while(v)},error:function(t){e.close();sap.m.MessageBox.error(t.message)}});var R=this;R.getView().setModel(l,"itemModel");R.oTableRecCount=l.getData().results.length;R.onComplete=true;this.oBusyDialog.close()}},onExport:function(){var e=this.oTableRecCount;if(e===0){var t=this.getView().getModel("i18n").getResourceBundle().getText("oTableNoDataText");sap.m.MessageBox.warning(t)}else{var a=new Date;var i=a.getUTCDate()+"-"+(a.getUTCMonth()+1)+"-"+a.getUTCFullYear()+" "+a.getUTCHours()+":"+a.getUTCMinutes()+":"+a.getUTCSeconds();var l="Bom Data_".concat(i);var r=new sap.ui.core.util.Export({exportType:new sap.ui.core.util.ExportTypeCSV({separatorChar:",",charset:"utf-8"}),models:this.getView().getModel("itemModel"),rows:{path:"/results"},columns:this.jsonArr});r.saveFile(l).catch(function(e){s.error("Error when downloading data."+e)}).then(function(){r.destroy()})}},onExport1:function(){var e=this.getView().getModel("BRF").getData();if(e===0){var t=this.getView().getModel("i18n").getResourceBundle().getText("oTableNoDataText");sap.m.MessageBox.warning(t)}else{var a=new Date;var i=a.getUTCDate()+"-"+(a.getUTCMonth()+1)+"-"+a.getUTCFullYear()+" "+a.getUTCHours()+":"+a.getUTCMinutes()+":"+a.getUTCSeconds();var l="Bom Data_".concat(i);var r=this.jsonArr;var s,o,u;s=this.getView().getModel("BRF").getProperty("/");o={workbook:{columns:r},dataSource:s,showProgress:false,fileName:l};u=new n(o);u.build().then(function(){d.show("Spreadsheet export has finished")}).finally(function(){u.destroy()})}},onReset:function(e){this.getView().byId("multiInput").removeAllTokens();this.getView().byId("idPlant").setValue("");this.getView().byId("idBOMUsage1").setValue("");this.getView().byId("idBOMUsage2").setValue("");var t=new sap.ui.model.json.JSONModel;var a=[];t.setData(a);var i=t.getProperty("/d/results");t.setData({modelData:i});this.getView().setModel(t,"itemModel")},handleSortButtonPressed:function(e){if(!this._oViewSettingsDialog){this._oViewSettingsDialog=sap.ui.xmlfragment("com.bom.sap.com.zbomapp.view.SortDialog",this);this.getView().addDependent(this._oViewSettingsDialog);this._oViewSettingsDialog.addStyleClass(this.getOwnerComponent().getContentDensityClass())}this._oViewSettingsDialog.open()},onCancelReject:function(e){if(this._oViewSettingsDialog.isOpen()){this._oViewSettingsDialog.close()}},handleSortStdConfirm:function(e){var t=this.oTableRecCount;if(t===0){var a=this.getView().getModel("i18n").getResourceBundle().getText("oTableNoDataText");sap.m.MessageBox.warning(a)}else{var i=e.getParameters().sortDescending;var l=e.getParameters().sortItem.getText();var r;var s=false;var o=[];var n;if(i){r=true}else{r=false}var u=this.getView();var d=u.byId("table");var m=d.getBinding("items");if(l==="Header Material"){n="BillOfMaterialVersion"}else if(l==="BOM Component"){n="Material"}else if(l==="Component Description"){n="ComponentDescription"}else if(l==="Level"){n="IsSubItem"}else if(l==="BOM Item No"){n="BillOfMaterialItemNumber"}o.push(new sap.ui.model.Sorter(n,r,s));m.sort(o)}},onOK:function(e){var t=[];var a=[];var i=this.oJSONModel.oData.Items.length;var l=0;for(var r=0;r<i;r++){if(this.oJSONModel.oData.ColumnsItems[r].visible===true){t[l]=this.oJSONModel.oData.ColumnsItems[r].columnKey;var s=this.oJSONModel.oData.ColumnsItems[r].columnKey;for(var o=0;o<i;o++){if(s===this.oJSONModel.oData.Items[o].columnKey){a[l]=this.oJSONModel.oData.Items[o].text;l=l+1}}}}this.jsonArr=[];for(var n=0;n<t.length;n++){var u=t[n];this.jsonArr.push({label:a[n],property:u})}this.oDataBeforeOpen={};e.getSource().close();e.getSource().destroy();this.onExport1()},onCancel:function(e){this.oJSONModel.setProperty("/",jQuery.extend(true,[],this.oDataBeforeOpen));this.oDataBeforeOpen={};e.getSource().close();e.getSource().destroy()},onReset1:function(){this.oJSONModel.setProperty("/",jQuery.extend(true,[],this.oDataInitial))},onChangeColumnsItems:function(e){this.oJSONModel.setProperty("/ColumnsItems",e.getParameter("items"));this.oJSONModel.setProperty("/ShowResetEnabled",this._isChangedColumnsItems())},_isChangedColumnsItems:function(){var e=function(e,t,a){var i=a.filter(function(a){return a[e]!==undefined&&a[e]===t});return i.length?i[0]:null};var t=function(t,a){if(!a){return jQuery.extend(true,[],t)}var i=jQuery.extend(true,[],a);t.forEach(function(t){var a=e("columnKey",t.columnKey,i);if(!a){i.push(t);return}if(a.visible===undefined&&t.visible!==undefined){a.visible=t.visible}if(a.width===undefined&&t.width!==undefined){a.width=t.width}if(a.total===undefined&&t.total!==undefined){a.total=t.total}if(a.index===undefined&&t.index!==undefined){a.index=t.index}});return i};var a=function(e,t){if(!t){return true}if(e.length!==t.length){return false}var a=function(e,t){if(e.columnKey<t.columnKey){return-1}else if(e.columnKey>t.columnKey){return 1}else{return 0}};e.sort(a);t.sort(a);var i=e.filter(function(e,a){return e.columnKey!==t[a].columnKey||e.visible!==t[a].visible||e.index!==t[a].index||e.width!==t[a].width||e.total!==t[a].total});return i.length===0};var i=t(this.oDataInitial.ColumnsItems,this.oJSONModel.getProperty("/ColumnsItems"));return!a(i,this.oDataInitial.ColumnsItems)}})});